!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e=e||self).tixRestQuery={},e.react)}(this,function(e,t){function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var n=t.createContext({store:null});function o(e){t.useEffect(e,[])}var a={isLoading:!1,error:null,data:null},c={CACHE_FIRST:"cache-first",NETWORK_ONLY:"network-only",CACHE_ONLY:"cache-only"},i={key:null,cachePolicy:c.CACHE_FIRST},s=function(){},u={isStreaming:!1,isStreamingDone:!1,error:null,data:null},l={streamEndFlag:"isStreamEnded",reqBodyParamsKey:"requestKeys",initialRequestBodyParams:null,responseReqBodyExtractorKey:"requestKeys",stopStreamOnError:!1,stackDataMapper:function(e){return e},stackDataReducer:function(){return{}},onStreamEnd:s,onNextTick:s,onStreamError:s,streamDataFlow:"stack"};e.RestQueryProvider=function(e){var o=e.children,a=t.useState({}),c=a[0],i=a[1];return t.createElement(n.Provider,{value:{store:c,getCachedData:function(e){if(!c[e])return null;try{var t;return JSON.parse(null==(t=c[e])?void 0:t.data)}catch(e){return console.log("[RESTICACHE ERROR]",e),null}},setCacheData:function(e,t){var n,o=JSON.stringify(t);i(r({},c,((n={})[e]={data:o,cacheStoredAt:null,cacheExpiredAt:null},n)))}}},o)},e.useCacheable=function(e,s){void 0===s&&(s=i);var u,l,d=(u=s,l=r({},i),Object.keys(u).forEach(function(e){Object.prototype.hasOwnProperty.call(i,e)?l[e]=u[e]:console.warn("[RESTICACHE WARNING]",function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),l),f=t.useContext(n),h=d.key||btoa(e),y=f.getCachedData(h),m=Boolean(y),p=d.cachePolicy!==c.NETWORK_ONLY,v=[c.CACHE_FIRST,c.NETWORK_ONLY].includes(d.cachePolicy),P=m&&p,E=r({},a,{data:y}),O=t.useState(P?E:a),C=O[0],S=O[1],R=t.useCallback(function(){try{return m||!v?Promise.resolve():(S(r({},C,{isLoading:!0})),Promise.resolve(function(e){try{return Promise.resolve(window.fetch(e)).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(e)).then(function(e){S(r({},C,{data:e})),p&&f.setCacheData(h,e)}))}catch(e){return Promise.reject(e)}},[m,v,C,e,p,f,h]);return o(function(){R()}),C},e.useStreamable=function(e,n){void 0===n&&(n=l);var a,c,i=(a=n,c=r({},l),Object.keys(a).forEach(function(e){Object.prototype.hasOwnProperty.call(l,e)?c[e]=a[e]:console.warn("[RESTICACHE WARNING]",function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),c),s=t.useState(u),d=s[0],f=s[1],h=t.useCallback(function(t,n){void 0===t&&(t={}),void 0===n&&(n=[]);try{return Promise.resolve(function(o,a){try{var c=Promise.resolve(function(e,t){try{return Promise.resolve(window.fetch(e,{method:"POST",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(e,t)).then(function(e){if(i.onNextTick(),!1!==e[i.streamEndFlag]){if(!0===e[i.streamEndFlag]){if(i.onStreamEnd(),"stack"===i.streamDataFlow)return void f(r({},d,{data:[].concat(n,[r({},e)]).map(i.stackDataMapper)}));if("object"===i.streamDataFlow)return void f(r({},d,{data:[].concat(n,[r({},e)]).map(i.stackDataMapper).reduce(i.stackDataReducer)}))}console.warn("Stream ended due to stream ending flag is not found or not a proper boolean value")}else{var t;h(((t={})[i.reqBodyParamsKey]=e[i.responseReqBodyExtractorKey],t),[].concat(n,[r({},e)]))}})}catch(e){return a(e)}return c&&c.then?c.then(void 0,a):c}(0,function(e){console.log("something went wrong ",e)}))}catch(e){return Promise.reject(e)}},[e,i,d]);return o(function(){var e;h(((e={})[i.reqBodyParamsKey]=i.initialRequestBodyParams,e))}),d}});
//# sourceMappingURL=index.umd.js.map
