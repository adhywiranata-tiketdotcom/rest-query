!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e=e||self).tixRestQuery={},e.react)}(this,function(e,t){function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var n=t.createContext({store:null}),o=function(e){try{return Promise.resolve(window.fetch(e)).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}},a=function(e,t){try{return Promise.resolve(window.fetch(e,{method:"POST",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}};function c(e){t.useEffect(e,[])}var i="[TIX REST QUERY WARNING]",s="[TIX REST QUERY ERROR]",u=function(){var e;(e=console).warn.apply(e,[i].concat([].slice.call(arguments)))},h=function(){var e;(e=console).error.apply(e,[s].concat([].slice.call(arguments)))},l={isLoading:!1,error:null,data:null},f={CACHE_FIRST:"cache-first",NETWORK_ONLY:"network-only",CACHE_ONLY:"cache-only"},d={key:null,cachePolicy:f.CACHE_FIRST},m={isLoading:!1,error:null,data:null,refetch:function(){}},y={key:null,httpFetchMethod:"GET",httpFetchBody:null},p=function(){},v={isStreaming:!1,isStreamingDone:!1,error:null,data:null},P={streamEndFlag:"isStreamEnded",reqBodyParamsKey:"requestKeys",initialRequestBodyParams:null,responseReqBodyExtractorKey:"requestKeys",stopStreamOnError:!1,stackDataMapper:function(e){return e},stackDataReducer:function(){return{}},onStreamEnd:p,onNextTick:p,onStreamError:p,streamDataFlow:"stack"};e.RestQueryProvider=function(e){var o=e.children,a=t.useState({}),c=a[0],i=a[1];return t.createElement(n.Provider,{value:{store:c,getCachedData:function(e){if(!c[e])return null;try{var t;return JSON.parse(null==(t=c[e])?void 0:t.data)}catch(e){return h("something went wrong when deserializing data ",e),null}},setCacheData:function(e,t){var n,o=JSON.stringify(t);i(r({},c,((n={})[e]={data:o,cacheStoredAt:null,cacheExpiredAt:null},n)))}}},o)},e.useCacheable=function(e,a){void 0===a&&(a=d);var i,s,h=(i=a,s=r({},d),Object.keys(i).forEach(function(e){Object.prototype.hasOwnProperty.call(d,e)?s[e]=i[e]:u(function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),s),m=t.useContext(n),y=h.key||btoa(e),p=m.getCachedData(y),v=Boolean(p),P=h.cachePolicy!==f.NETWORK_ONLY,E=[f.CACHE_FIRST,f.NETWORK_ONLY].includes(h.cachePolicy),O=v&&P,S=r({},l,{data:p}),g=t.useState(O?S:l),w=g[0],j=g[1],F=t.useCallback(function(){try{return v||!E?Promise.resolve():(j(r({},w,{isLoading:!0})),Promise.resolve(o(e)).then(function(e){j(r({},w,{data:e})),P&&m.setCacheData(y,e)}))}catch(e){return Promise.reject(e)}},[v,E,w,e,P,m,y]);return c(function(){F()}),w},e.useFetchable=function(e,n){void 0===n&&(n=y);var i,s,h=(i=n,s=r({},y),Object.keys(i).forEach(function(e){Object.prototype.hasOwnProperty.call(y,e)?s[e]=i[e]:u(function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),s),l=t.useState(m),f=l[0],d=l[1],p=t.useCallback(function(){try{var t,n=function(){function n(){function n(){function n(){function n(){d(r({},f,{data:t}))}var o=function(){if("PATCH"===h.httpFetchMethod)return Promise.resolve(function(e,t){try{return Promise.resolve(window.fetch(e,{method:"PATCH",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(e,h.httpFetchBody)).then(function(e){t=e})}();return o&&o.then?o.then(n):n()}var o=function(){if("DELETE"===h.httpFetchMethod)return Promise.resolve(function(e){try{return Promise.resolve(window.fetch(e,{method:"DELETE"})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(e)).then(function(e){t=e})}();return o&&o.then?o.then(n):n()}var o=function(){if("PUT"===h.httpFetchMethod)return Promise.resolve(function(e,t){try{return Promise.resolve(window.fetch(e,{method:"PUT",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(e,h.httpFetchBody)).then(function(e){t=e})}();return o&&o.then?o.then(n):n()}var o=function(){if("POST"===h.httpFetchMethod)return Promise.resolve(a(e,h.httpFetchBody)).then(function(e){t=e})}();return o&&o.then?o.then(n):n()};d(r({},f,{isLoading:!0}));var c=function(){if("GET"===h.httpFetchMethod)return Promise.resolve(o(e)).then(function(e){t=e})}();return Promise.resolve(c&&c.then?c.then(n):n())}catch(e){return Promise.reject(e)}},[f,h.httpFetchBody,h.httpFetchMethod,e]);return c(function(){p()}),r({},f,{refetch:p})},e.useStreamable=function(e,n){void 0===n&&(n=P);var o,i,s=(o=n,i=r({},P),Object.keys(o).forEach(function(e){Object.prototype.hasOwnProperty.call(P,e)?i[e]=o[e]:u(function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),i),l=t.useState(v),f=l[0],d=l[1],m=t.useCallback(function(t,n){void 0===t&&(t={}),void 0===n&&(n=[]);try{return Promise.resolve(function(o,c){try{var i=Promise.resolve(a(e,t)).then(function(e){if(s.onNextTick(),!1!==e[s.streamEndFlag]){if(!0===e[s.streamEndFlag]){if(s.onStreamEnd(),"stack"===s.streamDataFlow)return void d(r({},f,{data:[].concat(n,[r({},e)]).map(s.stackDataMapper)}));if("object"===s.streamDataFlow)return void d(r({},f,{data:[].concat(n,[r({},e)]).map(s.stackDataMapper).reduce(s.stackDataReducer)}))}u("Stream ended due to stream ending flag is not found or not a proper boolean value")}else{var t;m(((t={})[s.reqBodyParamsKey]=e[s.responseReqBodyExtractorKey],t),[].concat(n,[r({},e)]))}})}catch(e){return c(e)}return i&&i.then?i.then(void 0,c):i}(0,function(e){h("something went wrong ",e)}))}catch(e){return Promise.reject(e)}},[e,s,f]);return c(function(){var e;m(((e={})[s.reqBodyParamsKey]=s.initialRequestBodyParams,e))}),f}});
//# sourceMappingURL=index.umd.js.map
