!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e=e||self).tixFlightFeRestQuery={},e.react)}(this,function(e,t){function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var n=t.createContext({store:null}),o=function(e){try{return Promise.resolve(window.fetch(e)).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}},a=function(e,t){try{return Promise.resolve(window.fetch(e,{method:"POST",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}};function i(e){t.useEffect(e,[])}var c="[TIX REST QUERY WARNING]",s="[TIX REST QUERY ERROR]",u=function(){var e;(e=console).warn.apply(e,[c].concat([].slice.call(arguments)))},h=function(){var e;(e=console).error.apply(e,[s].concat([].slice.call(arguments)))},l=window.localStorage,f=function(){function e(){}return e.save=function(t,r){var n=e.getStore();n[t]=r,e.setStore(n)},e.getStore=function(){return JSON.parse(l.getItem("tix_rest_query_persisted_cache")||"{}")},e.setStore=function(e){l.setItem("tix_rest_query_persisted_cache",JSON.stringify(e))},e.removeStore=function(){l.removeItem("tix_rest_query_persisted_cache")},e}(),d={isLoading:!1,error:null,data:null},m={CACHE_FIRST:"cache-first",NETWORK_ONLY:"network-only",CACHE_ONLY:"cache-only"},y={key:null,cachePolicy:m.CACHE_FIRST,shouldPersist:!1},p={isLoading:!1,error:null,data:null,refetch:function(){}},v={key:null,httpFetchMethod:"GET",httpFetchBody:null},P=function(){},E={isStreaming:!1,isStreamingDone:!1,error:null,data:null},S={streamEndFlag:"isStreamEnded",reqBodyParamsKey:"requestKeys",initialRequestBodyParams:null,responseReqBodyExtractorKey:"requestKeys",stopStreamOnError:!1,stackDataMapper:function(e){return e},stackDataReducer:function(){return{}},onStreamEnd:P,onNextTick:P,onStreamError:P,streamDataFlow:"stack"};e.RestQueryProvider=function(e){var o=e.children,a=f.getStore(),i=t.useState(a),c=i[0],s=i[1];return t.createElement(n.Provider,{value:{store:c,getCachedData:function(e){if(!c[e])return null;try{var t;return JSON.parse(null==(t=c[e])?void 0:t.data)}catch(e){return h("something went wrong when deserializing data ",e),null}},setCacheData:function(e,t,n){var o,a={data:JSON.stringify(t),cacheStoredAt:null,cacheExpiredAt:null};n.shouldPersist&&f.save(e,a),s(r({},c,((o={})[e]=a,o)))}}},o)},e.useCacheable=function(e,a){void 0===a&&(a=y);var c,s,h=(c=a,s=r({},y),Object.keys(c).forEach(function(e){Object.prototype.hasOwnProperty.call(y,e)?s[e]=c[e]:u(function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),s),l=t.useContext(n),f=h.key||btoa(e),p=l.getCachedData(f),v=Boolean(p),P=h.cachePolicy!==m.NETWORK_ONLY,E=[m.CACHE_FIRST,m.NETWORK_ONLY].includes(h.cachePolicy),S=v&&P,O=r({},d,{data:p}),g=t.useState(S?O:d),w=g[0],F=g[1],j=t.useCallback(function(){try{return v||!E?Promise.resolve():(F(r({},w,{isLoading:!0})),Promise.resolve(o(e)).then(function(e){F(r({},w,{data:e})),P&&l.setCacheData(f,e,h)}))}catch(e){return Promise.reject(e)}},[v,E,w,e,P,l,f,h]);return i(function(){j()}),w},e.useFetchable=function(e,n){void 0===n&&(n=v);var c,s,h=(c=n,s=r({},v),Object.keys(c).forEach(function(e){Object.prototype.hasOwnProperty.call(v,e)?s[e]=c[e]:u(function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),s),l=t.useState(p),f=l[0],d=l[1],m=t.useCallback(function(){try{var t,n=function(){function n(){function n(){function n(){function n(){d(r({},f,{data:t}))}var o=function(){if("PATCH"===h.httpFetchMethod)return Promise.resolve(function(e,t){try{return Promise.resolve(window.fetch(e,{method:"PATCH",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(e,h.httpFetchBody)).then(function(e){t=e})}();return o&&o.then?o.then(n):n()}var o=function(){if("DELETE"===h.httpFetchMethod)return Promise.resolve(function(e){try{return Promise.resolve(window.fetch(e,{method:"DELETE"})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(e)).then(function(e){t=e})}();return o&&o.then?o.then(n):n()}var o=function(){if("PUT"===h.httpFetchMethod)return Promise.resolve(function(e,t){try{return Promise.resolve(window.fetch(e,{method:"PUT",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(e,h.httpFetchBody)).then(function(e){t=e})}();return o&&o.then?o.then(n):n()}var o=function(){if("POST"===h.httpFetchMethod)return Promise.resolve(a(e,h.httpFetchBody)).then(function(e){t=e})}();return o&&o.then?o.then(n):n()};d(r({},f,{isLoading:!0}));var i=function(){if("GET"===h.httpFetchMethod)return Promise.resolve(o(e)).then(function(e){t=e})}();return Promise.resolve(i&&i.then?i.then(n):n())}catch(e){return Promise.reject(e)}},[f,h.httpFetchBody,h.httpFetchMethod,e]);return i(function(){m()}),r({},f,{refetch:m})},e.useStreamable=function(e,n){void 0===n&&(n=S);var o,c,s=(o=n,c=r({},S),Object.keys(o).forEach(function(e){Object.prototype.hasOwnProperty.call(S,e)?c[e]=o[e]:u(function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),c),l=t.useState(E),f=l[0],d=l[1],m=t.useCallback(function(t,n){void 0===t&&(t={}),void 0===n&&(n=[]);try{return Promise.resolve(function(o,i){try{var c=Promise.resolve(a(e,t)).then(function(e){if(s.onNextTick(),!1!==e[s.streamEndFlag]){if(!0===e[s.streamEndFlag]){if(s.onStreamEnd(),"stack"===s.streamDataFlow)return void d(r({},f,{data:[].concat(n,[r({},e)]).map(s.stackDataMapper)}));if("object"===s.streamDataFlow)return void d(r({},f,{data:[].concat(n,[r({},e)]).map(s.stackDataMapper).reduce(s.stackDataReducer)}))}u("Stream ended due to stream ending flag is not found or not a proper boolean value")}else{var t;m(((t={})[s.reqBodyParamsKey]=e[s.responseReqBodyExtractorKey],t),[].concat(n,[r({},e)]))}})}catch(e){return i(e)}return c&&c.then?c.then(void 0,i):c}(0,function(e){h("something went wrong ",e)}))}catch(e){return Promise.reject(e)}},[e,s,f]);return i(function(){var e;m(((e={})[s.reqBodyParamsKey]=s.initialRequestBodyParams,e))}),f}});
//# sourceMappingURL=index.umd.js.map
