var e=require("react");function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var r=e.createContext({store:null}),n=function(e){try{return Promise.resolve(window.fetch(e)).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}},o=function(e,t){try{return Promise.resolve(window.fetch(e,{method:"POST",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}};function a(t){e.useEffect(t,[])}var c="[TIX REST QUERY WARNING]",i="[TIX REST QUERY ERROR]",s=function(){var e;(e=console).warn.apply(e,[c].concat([].slice.call(arguments)))},u=function(){var e;(e=console).error.apply(e,[i].concat([].slice.call(arguments)))},h=window.localStorage,l=function(){function e(){}return e.save=function(t,r){var n=e.getStore();n[t]=r,e.setStore(n)},e.getStore=function(){return JSON.parse(h.getItem("tix_rest_query_persisted_cache")||"{}")},e.setStore=function(e){h.setItem("tix_rest_query_persisted_cache",JSON.stringify(e))},e.removeStore=function(){h.removeItem("tix_rest_query_persisted_cache")},e}(),f={isLoading:!1,error:null,data:null},d={CACHE_FIRST:"cache-first",NETWORK_ONLY:"network-only",CACHE_ONLY:"cache-only"},m={key:null,cachePolicy:d.CACHE_FIRST,shouldPersist:!1},y={isLoading:!1,error:null,data:null,refetch:function(){}},p={key:null,httpFetchMethod:"GET",httpFetchBody:null},v=function(){},P={isStreaming:!1,isStreamingDone:!1,error:null,data:null},E={streamEndFlag:"isStreamEnded",reqBodyParamsKey:"requestKeys",initialRequestBodyParams:null,responseReqBodyExtractorKey:"requestKeys",stopStreamOnError:!1,stackDataMapper:function(e){return e},stackDataReducer:function(){return{}},onStreamEnd:v,onNextTick:v,onStreamError:v,streamDataFlow:"stack"};exports.RestQueryProvider=function(n){var o=n.children,a=l.getStore(),c=e.useState(a),i=c[0],s=c[1];return e.createElement(r.Provider,{value:{store:i,getCachedData:function(e){if(!i[e])return null;try{var t;return JSON.parse(null==(t=i[e])?void 0:t.data)}catch(e){return u("something went wrong when deserializing data ",e),null}},setCacheData:function(e,r,n){var o,a={data:JSON.stringify(r),cacheStoredAt:null,cacheExpiredAt:null};n.shouldPersist&&l.save(e,a),s(t({},i,((o={})[e]=a,o)))}}},o)},exports.useCacheable=function(o,c){void 0===c&&(c=m);var i,u,h=(i=c,u=t({},m),Object.keys(i).forEach(function(e){Object.prototype.hasOwnProperty.call(m,e)?u[e]=i[e]:s(function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),u),l=e.useContext(r),y=h.key||btoa(o),p=l.getCachedData(y),v=Boolean(p),P=h.cachePolicy!==d.NETWORK_ONLY,E=[d.CACHE_FIRST,d.NETWORK_ONLY].includes(h.cachePolicy),S=v&&P,O=t({},f,{data:p}),g=e.useState(S?O:f),w=g[0],j=g[1],F=e.useCallback(function(){try{return v||!E?Promise.resolve():(j(t({},w,{isLoading:!0})),Promise.resolve(n(o)).then(function(e){j(t({},w,{data:e})),P&&l.setCacheData(y,e,h)}))}catch(e){return Promise.reject(e)}},[v,E,w,o,P,l,y,h]);return a(function(){F()}),w},exports.useFetchable=function(r,c){void 0===c&&(c=p);var i,u,h=(i=c,u=t({},p),Object.keys(i).forEach(function(e){Object.prototype.hasOwnProperty.call(p,e)?u[e]=i[e]:s(function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),u),l=e.useState(y),f=l[0],d=l[1],m=e.useCallback(function(){try{var e,a=function(){function n(){function n(){function n(){function n(){d(t({},f,{data:e}))}var o=function(){if("PATCH"===h.httpFetchMethod)return Promise.resolve(function(e,t){try{return Promise.resolve(window.fetch(e,{method:"PATCH",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(r,h.httpFetchBody)).then(function(t){e=t})}();return o&&o.then?o.then(n):n()}var o=function(){if("DELETE"===h.httpFetchMethod)return Promise.resolve(function(e){try{return Promise.resolve(window.fetch(e,{method:"DELETE"})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(r)).then(function(t){e=t})}();return o&&o.then?o.then(n):n()}var o=function(){if("PUT"===h.httpFetchMethod)return Promise.resolve(function(e,t){try{return Promise.resolve(window.fetch(e,{method:"PUT",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(r,h.httpFetchBody)).then(function(t){e=t})}();return o&&o.then?o.then(n):n()}var a=function(){if("POST"===h.httpFetchMethod)return Promise.resolve(o(r,h.httpFetchBody)).then(function(t){e=t})}();return a&&a.then?a.then(n):n()};d(t({},f,{isLoading:!0}));var c=function(){if("GET"===h.httpFetchMethod)return Promise.resolve(n(r)).then(function(t){e=t})}();return Promise.resolve(c&&c.then?c.then(a):a())}catch(e){return Promise.reject(e)}},[f,h.httpFetchBody,h.httpFetchMethod,r]);return a(function(){m()}),t({},f,{refetch:m})},exports.useStreamable=function(r,n){void 0===n&&(n=E);var c,i,h=(c=n,i=t({},E),Object.keys(c).forEach(function(e){Object.prototype.hasOwnProperty.call(E,e)?i[e]=c[e]:s(function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),i),l=e.useState(P),f=l[0],d=l[1],m=e.useCallback(function(e,n){void 0===e&&(e={}),void 0===n&&(n=[]);try{return Promise.resolve(function(a,c){try{var i=Promise.resolve(o(r,e)).then(function(e){if(h.onNextTick(),!1!==e[h.streamEndFlag]){if(!0===e[h.streamEndFlag]){if(h.onStreamEnd(),"stack"===h.streamDataFlow)return void d(t({},f,{data:[].concat(n,[t({},e)]).map(h.stackDataMapper)}));if("object"===h.streamDataFlow)return void d(t({},f,{data:[].concat(n,[t({},e)]).map(h.stackDataMapper).reduce(h.stackDataReducer)}))}s("Stream ended due to stream ending flag is not found or not a proper boolean value")}else{var r;m(((r={})[h.reqBodyParamsKey]=e[h.responseReqBodyExtractorKey],r),[].concat(n,[t({},e)]))}})}catch(e){return c(e)}return i&&i.then?i.then(void 0,c):i}(0,function(e){u("something went wrong ",e)}))}catch(e){return Promise.reject(e)}},[r,h,f]);return a(function(){var e;m(((e={})[h.reqBodyParamsKey]=h.initialRequestBodyParams,e))}),f};
//# sourceMappingURL=index.js.map
