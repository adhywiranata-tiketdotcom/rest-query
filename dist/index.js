var e=require("react");function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var r=e.createContext({store:null}),n=function(e){try{return Promise.resolve(window.fetch(e)).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}},o=function(e,t){try{return Promise.resolve(window.fetch(e,{method:"POST",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}};function a(t){e.useEffect(t,[])}var c="[TIX REST QUERY WARNING]",i="[TIX REST QUERY ERROR]",s=function(){var e;(e=console).warn.apply(e,[c].concat([].slice.call(arguments)))},u=function(){var e;(e=console).error.apply(e,[i].concat([].slice.call(arguments)))},h={isLoading:!1,error:null,data:null},l={CACHE_FIRST:"cache-first",NETWORK_ONLY:"network-only",CACHE_ONLY:"cache-only"},f={key:null,cachePolicy:l.CACHE_FIRST},d={isLoading:!1,error:null,data:null,refetch:function(){}},m={key:null,httpFetchMethod:"GET",httpFetchBody:null},y=function(){},p={isStreaming:!1,isStreamingDone:!1,error:null,data:null},v={streamEndFlag:"isStreamEnded",reqBodyParamsKey:"requestKeys",initialRequestBodyParams:null,responseReqBodyExtractorKey:"requestKeys",stopStreamOnError:!1,stackDataMapper:function(e){return e},stackDataReducer:function(){return{}},onStreamEnd:y,onNextTick:y,onStreamError:y,streamDataFlow:"stack"};exports.RestQueryProvider=function(n){var o=n.children,a=e.useState({}),c=a[0],i=a[1];return e.createElement(r.Provider,{value:{store:c,getCachedData:function(e){if(!c[e])return null;try{var t;return JSON.parse(null==(t=c[e])?void 0:t.data)}catch(e){return u("something went wrong when deserializing data ",e),null}},setCacheData:function(e,r){var n,o=JSON.stringify(r);i(t({},c,((n={})[e]={data:o,cacheStoredAt:null,cacheExpiredAt:null},n)))}}},o)},exports.useCacheable=function(o,c){void 0===c&&(c=f);var i,u,d=(i=c,u=t({},f),Object.keys(i).forEach(function(e){Object.prototype.hasOwnProperty.call(f,e)?u[e]=i[e]:s(function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),u),m=e.useContext(r),y=d.key||btoa(o),p=m.getCachedData(y),v=Boolean(p),P=d.cachePolicy!==l.NETWORK_ONLY,E=[l.CACHE_FIRST,l.NETWORK_ONLY].includes(d.cachePolicy),O=v&&P,S=t({},h,{data:p}),g=e.useState(O?S:h),w=g[0],j=g[1],F=e.useCallback(function(){try{return v||!E?Promise.resolve():(j(t({},w,{isLoading:!0})),Promise.resolve(n(o)).then(function(e){j(t({},w,{data:e})),P&&m.setCacheData(y,e)}))}catch(e){return Promise.reject(e)}},[v,E,w,o,P,m,y]);return a(function(){F()}),w},exports.useFetchable=function(r,c){void 0===c&&(c=m);var i,u,h=(i=c,u=t({},m),Object.keys(i).forEach(function(e){Object.prototype.hasOwnProperty.call(m,e)?u[e]=i[e]:s(function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),u),l=e.useState(d),f=l[0],y=l[1],p=e.useCallback(function(){try{var e,a=function(){function n(){function n(){function n(){function n(){y(t({},f,{data:e}))}var o=function(){if("PATCH"===h.httpFetchMethod)return Promise.resolve(function(e,t){try{return Promise.resolve(window.fetch(e,{method:"PATCH",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(r,h.httpFetchBody)).then(function(t){e=t})}();return o&&o.then?o.then(n):n()}var o=function(){if("DELETE"===h.httpFetchMethod)return Promise.resolve(function(e){try{return Promise.resolve(window.fetch(e,{method:"DELETE"})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(r)).then(function(t){e=t})}();return o&&o.then?o.then(n):n()}var o=function(){if("PUT"===h.httpFetchMethod)return Promise.resolve(function(e,t){try{return Promise.resolve(window.fetch(e,{method:"PUT",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(r,h.httpFetchBody)).then(function(t){e=t})}();return o&&o.then?o.then(n):n()}var a=function(){if("POST"===h.httpFetchMethod)return Promise.resolve(o(r,h.httpFetchBody)).then(function(t){e=t})}();return a&&a.then?a.then(n):n()};y(t({},f,{isLoading:!0}));var c=function(){if("GET"===h.httpFetchMethod)return Promise.resolve(n(r)).then(function(t){e=t})}();return Promise.resolve(c&&c.then?c.then(a):a())}catch(e){return Promise.reject(e)}},[f,h.httpFetchBody,h.httpFetchMethod,r]);return a(function(){p()}),t({},f,{refetch:p})},exports.useStreamable=function(r,n){void 0===n&&(n=v);var c,i,h=(c=n,i=t({},v),Object.keys(c).forEach(function(e){Object.prototype.hasOwnProperty.call(v,e)?i[e]=c[e]:s(function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),i),l=e.useState(p),f=l[0],d=l[1],m=e.useCallback(function(e,n){void 0===e&&(e={}),void 0===n&&(n=[]);try{return Promise.resolve(function(a,c){try{var i=Promise.resolve(o(r,e)).then(function(e){if(h.onNextTick(),!1!==e[h.streamEndFlag]){if(!0===e[h.streamEndFlag]){if(h.onStreamEnd(),"stack"===h.streamDataFlow)return void d(t({},f,{data:[].concat(n,[t({},e)]).map(h.stackDataMapper)}));if("object"===h.streamDataFlow)return void d(t({},f,{data:[].concat(n,[t({},e)]).map(h.stackDataMapper).reduce(h.stackDataReducer)}))}s("Stream ended due to stream ending flag is not found or not a proper boolean value")}else{var r;m(((r={})[h.reqBodyParamsKey]=e[h.responseReqBodyExtractorKey],r),[].concat(n,[t({},e)]))}})}catch(e){return c(e)}return i&&i.then?i.then(void 0,c):i}(0,function(e){u("something went wrong ",e)}))}catch(e){return Promise.reject(e)}},[r,h,f]);return a(function(){var e;m(((e={})[h.reqBodyParamsKey]=h.initialRequestBodyParams,e))}),f};
//# sourceMappingURL=index.js.map
