var e=require("react");function t(){return(t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var r=e.createContext({store:null});function n(t){e.useEffect(t,[])}var a={isLoading:!1,error:null,data:null},o={CACHE_FIRST:"cache-first",NETWORK_ONLY:"network-only",CACHE_ONLY:"cache-only"},c={key:null,cachePolicy:o.CACHE_FIRST},s=function(){},i={isStreaming:!1,isStreamingDone:!1,error:null,data:null},u={streamEndFlag:"isStreamEnded",reqBodyParamsKey:"requestKeys",initialRequestBodyParams:null,responseReqBodyExtractorKey:"requestKeys",stopStreamOnError:!1,stackDataMapper:function(e){return e},stackDataReducer:function(){return{}},onStreamEnd:s,onNextTick:s,onStreamError:s,streamDataFlow:"stack"};exports.RestQueryProvider=function(n){var a=n.children,o=e.useState({}),c=o[0],s=o[1];return e.createElement(r.Provider,{value:{store:c,getCachedData:function(e){if(!c[e])return null;try{var t;return JSON.parse(null==(t=c[e])?void 0:t.data)}catch(e){return console.log("[RESTICACHE ERROR]",e),null}},setCacheData:function(e,r){var n,a=JSON.stringify(r);s(t({},c,((n={})[e]={data:a,cacheStoredAt:null,cacheExpiredAt:null},n)))}}},a)},exports.useCacheable=function(s,i){void 0===i&&(i=c);var u,l,d=(u=i,l=t({},c),Object.keys(u).forEach(function(e){Object.prototype.hasOwnProperty.call(c,e)?l[e]=u[e]:console.warn("[RESTICACHE WARNING]",function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),l),h=e.useContext(r),f=d.key||btoa(s),m=h.getCachedData(f),y=Boolean(m),p=d.cachePolicy!==o.NETWORK_ONLY,v=[o.CACHE_FIRST,o.NETWORK_ONLY].includes(d.cachePolicy),P=y&&p,E=t({},a,{data:m}),O=e.useState(P?E:a),C=O[0],S=O[1],R=e.useCallback(function(){try{return y||!v?Promise.resolve():(S(t({},C,{isLoading:!0})),Promise.resolve(function(e){try{return Promise.resolve(window.fetch(e)).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(s)).then(function(e){S(t({},C,{data:e})),p&&h.setCacheData(f,e)}))}catch(e){return Promise.reject(e)}},[y,v,C,s,p,h,f]);return n(function(){R()}),C},exports.useStreamable=function(r,a){void 0===a&&(a=u);var o,c,s=(o=a,c=t({},u),Object.keys(o).forEach(function(e){Object.prototype.hasOwnProperty.call(u,e)?c[e]=o[e]:console.warn("[RESTICACHE WARNING]",function(e){return"Option ["+e+"] is not part of the API. While this is not an error, ensure the options matches the API."}(e))}),c),l=e.useState(i),d=l[0],h=l[1],f=e.useCallback(function(e,n){void 0===e&&(e={}),void 0===n&&(n=[]);try{return Promise.resolve(function(a,o){try{var c=Promise.resolve(function(e,t){try{return Promise.resolve(window.fetch(e,{method:"POST",body:JSON.stringify(t)})).then(function(e){return Promise.resolve(e.json())})}catch(e){return Promise.reject(e)}}(r,e)).then(function(e){if(s.onNextTick(),!1!==e[s.streamEndFlag]){if(!0===e[s.streamEndFlag]){if(s.onStreamEnd(),"stack"===s.streamDataFlow)return void h(t({},d,{data:[].concat(n,[t({},e)]).map(s.stackDataMapper)}));if("object"===s.streamDataFlow)return void h(t({},d,{data:[].concat(n,[t({},e)]).map(s.stackDataMapper).reduce(s.stackDataReducer)}))}console.warn("Stream ended due to stream ending flag is not found or not a proper boolean value")}else{var r;f(((r={})[s.reqBodyParamsKey]=e[s.responseReqBodyExtractorKey],r),[].concat(n,[t({},e)]))}})}catch(e){return o(e)}return c&&c.then?c.then(void 0,o):c}(0,function(e){console.log("something went wrong ",e)}))}catch(e){return Promise.reject(e)}},[r,s,d]);return n(function(){var e;f(((e={})[s.reqBodyParamsKey]=s.initialRequestBodyParams,e))}),d};
//# sourceMappingURL=index.js.map
