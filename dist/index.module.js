import{createContext as t,useEffect as e,useState as r,createElement as n,useContext as o,useCallback as a}from"react";function c(){return(c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}var i=t({store:null}),s=function(t){try{return Promise.resolve(window.fetch(t)).then(function(t){return Promise.resolve(t.json())})}catch(t){return Promise.reject(t)}},u=function(t,e){try{return Promise.resolve(window.fetch(t,{method:"POST",body:JSON.stringify(e)})).then(function(t){return Promise.resolve(t.json())})}catch(t){return Promise.reject(t)}};function h(t){e(t,[])}var l="[TIX REST QUERY WARNING]",f="[TIX REST QUERY ERROR]",d=function(){var t;(t=console).warn.apply(t,[l].concat([].slice.call(arguments)))},m=function(){var t;(t=console).error.apply(t,[f].concat([].slice.call(arguments)))};function y(t){var e=t.children,o=r({}),a=o[0],s=o[1];return n(i.Provider,{value:{store:a,getCachedData:function(t){if(!a[t])return null;try{var e;return JSON.parse(null==(e=a[t])?void 0:e.data)}catch(t){return m("something went wrong when deserializing data ",t),null}},setCacheData:function(t,e){var r,n=JSON.stringify(e);s(c({},a,((r={})[t]={data:n,cacheStoredAt:null,cacheExpiredAt:null},r)))}}},e)}var v={isLoading:!1,error:null,data:null},p={CACHE_FIRST:"cache-first",NETWORK_ONLY:"network-only",CACHE_ONLY:"cache-only"},P={key:null,cachePolicy:p.CACHE_FIRST};function E(t,e){void 0===e&&(e=P);var n,u,l=(n=e,u=c({},P),Object.keys(n).forEach(function(t){Object.prototype.hasOwnProperty.call(P,t)?u[t]=n[t]:d(function(t){return"Option ["+t+"] is not part of the API. While this is not an error, ensure the options matches the API."}(t))}),u),f=o(i),m=l.key||btoa(t),y=f.getCachedData(m),E=Boolean(y),O=l.cachePolicy!==p.NETWORK_ONLY,g=[p.CACHE_FIRST,p.NETWORK_ONLY].includes(l.cachePolicy),w=E&&O,j=c({},v,{data:y}),T=r(w?j:v),F=T[0],S=T[1],R=a(function(){try{return E||!g?Promise.resolve():(S(c({},F,{isLoading:!0})),Promise.resolve(s(t)).then(function(t){S(c({},F,{data:t})),O&&f.setCacheData(m,t)}))}catch(t){return Promise.reject(t)}},[E,g,F,t,O,f,m]);return h(function(){R()}),F}var O={isLoading:!1,error:null,data:null,refetch:function(){}},g={key:null,httpFetchMethod:"GET",httpFetchBody:null};function w(t,e){void 0===e&&(e=g);var n,o,i=(n=e,o=c({},g),Object.keys(n).forEach(function(t){Object.prototype.hasOwnProperty.call(g,t)?o[t]=n[t]:d(function(t){return"Option ["+t+"] is not part of the API. While this is not an error, ensure the options matches the API."}(t))}),o),l=r(O),f=l[0],m=l[1],y=a(function(){try{var e,r=function(){function r(){function r(){function r(){function r(){m(c({},f,{data:e}))}var n=function(){if("PATCH"===i.httpFetchMethod)return Promise.resolve(function(t,e){try{return Promise.resolve(window.fetch(t,{method:"PATCH",body:JSON.stringify(e)})).then(function(t){return Promise.resolve(t.json())})}catch(t){return Promise.reject(t)}}(t,i.httpFetchBody)).then(function(t){e=t})}();return n&&n.then?n.then(r):r()}var n=function(){if("DELETE"===i.httpFetchMethod)return Promise.resolve(function(t){try{return Promise.resolve(window.fetch(t,{method:"DELETE"})).then(function(t){return Promise.resolve(t.json())})}catch(t){return Promise.reject(t)}}(t)).then(function(t){e=t})}();return n&&n.then?n.then(r):r()}var n=function(){if("PUT"===i.httpFetchMethod)return Promise.resolve(function(t,e){try{return Promise.resolve(window.fetch(t,{method:"PUT",body:JSON.stringify(e)})).then(function(t){return Promise.resolve(t.json())})}catch(t){return Promise.reject(t)}}(t,i.httpFetchBody)).then(function(t){e=t})}();return n&&n.then?n.then(r):r()}var n=function(){if("POST"===i.httpFetchMethod)return Promise.resolve(u(t,i.httpFetchBody)).then(function(t){e=t})}();return n&&n.then?n.then(r):r()};m(c({},f,{isLoading:!0}));var n=function(){if("GET"===i.httpFetchMethod)return Promise.resolve(s(t)).then(function(t){e=t})}();return Promise.resolve(n&&n.then?n.then(r):r())}catch(t){return Promise.reject(t)}},[f,i.httpFetchBody,i.httpFetchMethod,t]);return h(function(){y()}),c({},f,{refetch:y})}var j=function(){},T={isStreaming:!1,isStreamingDone:!1,error:null,data:null},F={streamEndFlag:"isStreamEnded",reqBodyParamsKey:"requestKeys",initialRequestBodyParams:null,responseReqBodyExtractorKey:"requestKeys",stopStreamOnError:!1,stackDataMapper:function(t){return t},stackDataReducer:function(){return{}},onStreamEnd:j,onNextTick:j,onStreamError:j,streamDataFlow:"stack"};function S(t,e){void 0===e&&(e=F);var n,o,i=(n=e,o=c({},F),Object.keys(n).forEach(function(t){Object.prototype.hasOwnProperty.call(F,t)?o[t]=n[t]:d(function(t){return"Option ["+t+"] is not part of the API. While this is not an error, ensure the options matches the API."}(t))}),o),s=r(T),l=s[0],f=s[1],y=a(function(e,r){void 0===e&&(e={}),void 0===r&&(r=[]);try{return Promise.resolve(function(n,o){try{var a=Promise.resolve(u(t,e)).then(function(t){if(i.onNextTick(),!1!==t[i.streamEndFlag]){if(!0===t[i.streamEndFlag]){if(i.onStreamEnd(),"stack"===i.streamDataFlow)return void f(c({},l,{data:[].concat(r,[c({},t)]).map(i.stackDataMapper)}));if("object"===i.streamDataFlow)return void f(c({},l,{data:[].concat(r,[c({},t)]).map(i.stackDataMapper).reduce(i.stackDataReducer)}))}d("Stream ended due to stream ending flag is not found or not a proper boolean value")}else{var e;y(((e={})[i.reqBodyParamsKey]=t[i.responseReqBodyExtractorKey],e),[].concat(r,[c({},t)]))}})}catch(t){return o(t)}return a&&a.then?a.then(void 0,o):a}(0,function(t){m("something went wrong ",t)}))}catch(t){return Promise.reject(t)}},[t,i,l]);return h(function(){var t;y(((t={})[i.reqBodyParamsKey]=i.initialRequestBodyParams,t))}),l}export{y as RestQueryProvider,E as useCacheable,w as useFetchable,S as useStreamable};
//# sourceMappingURL=index.module.js.map
