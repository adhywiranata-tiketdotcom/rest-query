import{createContext as t,useEffect as e,useState as r,createElement as n,useContext as o,useCallback as a}from"react";function i(){return(i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}var c=t({store:null}),s=function(t){try{return Promise.resolve(window.fetch(t)).then(function(t){return Promise.resolve(t.json())})}catch(t){return Promise.reject(t)}},u=function(t,e){try{return Promise.resolve(window.fetch(t,{method:"POST",body:JSON.stringify(e)})).then(function(t){return Promise.resolve(t.json())})}catch(t){return Promise.reject(t)}};function h(t){e(t,[])}var l="[TIX REST QUERY WARNING]",f="[TIX REST QUERY ERROR]",d=function(){var t;(t=console).warn.apply(t,[l].concat([].slice.call(arguments)))},m=function(){var t;(t=console).error.apply(t,[f].concat([].slice.call(arguments)))},y=function(){function t(){}return t.save=function(e,r){var n=t.getStore();n[e]=r,t.setStore(n)},t.getStore=function(){return JSON.parse(window.localStorage.getItem("tix_restQueryPersistedCache")||"{}")},t.setStore=function(t){window.localStorage.setItem("tix_restQueryPersistedCache",JSON.stringify(t))},t}();function v(t){var e=t.children,o=y.getStore(),a=r(o),s=a[0],u=a[1];return n(c.Provider,{value:{store:s,getCachedData:function(t){if(!s[t])return null;try{var e;return JSON.parse(null==(e=s[t])?void 0:e.data)}catch(t){return m("something went wrong when deserializing data ",t),null}},setCacheData:function(t,e,r){var n,o={data:JSON.stringify(e),cacheStoredAt:null,cacheExpiredAt:null};r.shouldPersist&&y.save(t,o),u(i({},s,((n={})[t]=o,n)))}}},e)}var p={isLoading:!1,error:null,data:null},P={CACHE_FIRST:"cache-first",NETWORK_ONLY:"network-only",CACHE_ONLY:"cache-only"},E={key:null,cachePolicy:P.CACHE_FIRST,shouldPersist:!1};function O(t,e){void 0===e&&(e=E);var n,u,l=(n=e,u=i({},E),Object.keys(n).forEach(function(t){Object.prototype.hasOwnProperty.call(E,t)?u[t]=n[t]:d(function(t){return"Option ["+t+"] is not part of the API. While this is not an error, ensure the options matches the API."}(t))}),u),f=o(c),m=l.key||btoa(t),y=f.getCachedData(m),v=Boolean(y),O=l.cachePolicy!==P.NETWORK_ONLY,g=[P.CACHE_FIRST,P.NETWORK_ONLY].includes(l.cachePolicy),S=v&&O,w=i({},p,{data:y}),j=r(S?w:p),T=j[0],F=j[1],R=a(function(){try{return v||!g?Promise.resolve():(F(i({},T,{isLoading:!0})),Promise.resolve(s(t)).then(function(t){F(i({},T,{data:t})),O&&f.setCacheData(m,t,l)}))}catch(t){return Promise.reject(t)}},[v,g,T,t,O,f,m,l]);return h(function(){R()}),T}var g={isLoading:!1,error:null,data:null,refetch:function(){}},S={key:null,httpFetchMethod:"GET",httpFetchBody:null};function w(t,e){void 0===e&&(e=S);var n,o,c=(n=e,o=i({},S),Object.keys(n).forEach(function(t){Object.prototype.hasOwnProperty.call(S,t)?o[t]=n[t]:d(function(t){return"Option ["+t+"] is not part of the API. While this is not an error, ensure the options matches the API."}(t))}),o),l=r(g),f=l[0],m=l[1],y=a(function(){try{var e,r=function(){function r(){function r(){function r(){function r(){m(i({},f,{data:e}))}var n=function(){if("PATCH"===c.httpFetchMethod)return Promise.resolve(function(t,e){try{return Promise.resolve(window.fetch(t,{method:"PATCH",body:JSON.stringify(e)})).then(function(t){return Promise.resolve(t.json())})}catch(t){return Promise.reject(t)}}(t,c.httpFetchBody)).then(function(t){e=t})}();return n&&n.then?n.then(r):r()}var n=function(){if("DELETE"===c.httpFetchMethod)return Promise.resolve(function(t){try{return Promise.resolve(window.fetch(t,{method:"DELETE"})).then(function(t){return Promise.resolve(t.json())})}catch(t){return Promise.reject(t)}}(t)).then(function(t){e=t})}();return n&&n.then?n.then(r):r()}var n=function(){if("PUT"===c.httpFetchMethod)return Promise.resolve(function(t,e){try{return Promise.resolve(window.fetch(t,{method:"PUT",body:JSON.stringify(e)})).then(function(t){return Promise.resolve(t.json())})}catch(t){return Promise.reject(t)}}(t,c.httpFetchBody)).then(function(t){e=t})}();return n&&n.then?n.then(r):r()}var n=function(){if("POST"===c.httpFetchMethod)return Promise.resolve(u(t,c.httpFetchBody)).then(function(t){e=t})}();return n&&n.then?n.then(r):r()};m(i({},f,{isLoading:!0}));var n=function(){if("GET"===c.httpFetchMethod)return Promise.resolve(s(t)).then(function(t){e=t})}();return Promise.resolve(n&&n.then?n.then(r):r())}catch(t){return Promise.reject(t)}},[f,c.httpFetchBody,c.httpFetchMethod,t]);return h(function(){y()}),i({},f,{refetch:y})}var j=function(){},T={isStreaming:!1,isStreamingDone:!1,error:null,data:null},F={streamEndFlag:"isStreamEnded",reqBodyParamsKey:"requestKeys",initialRequestBodyParams:null,responseReqBodyExtractorKey:"requestKeys",stopStreamOnError:!1,stackDataMapper:function(t){return t},stackDataReducer:function(){return{}},onStreamEnd:j,onNextTick:j,onStreamError:j,streamDataFlow:"stack"};function R(t,e){void 0===e&&(e=F);var n,o,c=(n=e,o=i({},F),Object.keys(n).forEach(function(t){Object.prototype.hasOwnProperty.call(F,t)?o[t]=n[t]:d(function(t){return"Option ["+t+"] is not part of the API. While this is not an error, ensure the options matches the API."}(t))}),o),s=r(T),l=s[0],f=s[1],y=a(function(e,r){void 0===e&&(e={}),void 0===r&&(r=[]);try{return Promise.resolve(function(n,o){try{var a=Promise.resolve(u(t,e)).then(function(t){if(c.onNextTick(),!1!==t[c.streamEndFlag]){if(!0===t[c.streamEndFlag]){if(c.onStreamEnd(),"stack"===c.streamDataFlow)return void f(i({},l,{data:[].concat(r,[i({},t)]).map(c.stackDataMapper)}));if("object"===c.streamDataFlow)return void f(i({},l,{data:[].concat(r,[i({},t)]).map(c.stackDataMapper).reduce(c.stackDataReducer)}))}d("Stream ended due to stream ending flag is not found or not a proper boolean value")}else{var e;y(((e={})[c.reqBodyParamsKey]=t[c.responseReqBodyExtractorKey],e),[].concat(r,[i({},t)]))}})}catch(t){return o(t)}return a&&a.then?a.then(void 0,o):a}(0,function(t){m("something went wrong ",t)}))}catch(t){return Promise.reject(t)}},[t,c,l]);return h(function(){var t;y(((t={})[c.reqBodyParamsKey]=c.initialRequestBodyParams,t))}),l}export{v as RestQueryProvider,O as useCacheable,w as useFetchable,R as useStreamable};
//# sourceMappingURL=index.module.js.map
